<script th:inline="javascript">
  /* 서버에서 온 locations를 JS 배열로 주입 */
  const locations = /*[[${locations}]]*/ [];
</script>
<script>
  function initMap() {
    const map = new google.maps.Map(document.getElementById('map_div'), {
      center: { lat: 36.3181, lng: 127.4212 }, // fallback
      zoom: 5
    });

    if (!locations || locations.length === 0) return;

    const bounds = new google.maps.LatLngBounds();
    const path = [];

    locations.forEach(l => {
      // ✅ Location의 getter(getLatitude/getLongitude/getName)로 값이 직렬화되어 들어옵니다
      const pos = { lat: Number(l.latitude), lng: Number(l.longitude) };
      path.push(pos);
      bounds.extend(pos);
      const mk = new google.maps.Marker({ position: pos, map, title: l.name || '' });
      const info = new google.maps.InfoWindow({ content: `<div>${l.name || ''}</div>` });
      mk.addListener('click', () => info.open(map, mk));
    });

    new google.maps.Polyline({ path, strokeColor: '#9400D3', strokeOpacity: 1.0, strokeWeight: 2, map });

    if (locations.length === 1) { map.setCenter(path[0]); map.setZoom(14); }
    else { map.fitBounds(bounds); }
  }
</script>

<div id="map_div" style="height:500px;width:100%;max-width:900px;margin:0 auto"></div>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAlCI_PdY5Z4dL-EXaMdagQlyaUAe6GpIs&libraries=visualization&callback=initMap">
</script>
